# RoboCopyMan

## 何をするものか？

- robocopy コマンドを定期的に実行するだけのソフトです。
でも案外このシンプルさを持つソフトはないので自分では重宝しています。

- ふだん Dropbox を作業フォルダに使用しているのですが心配性なので、定期的にローカルの NAS にバックアップをとりたいなと思い
いろいろ試してみました。
しかしながら、バッチファイルは窓が消せなかったり、タスクスケジューラでやろうにもパスワードレスのMicrosoftアカウントではやっぱり窓が消せなかったり、
その他あるかもしれないのですがよくわからないのでこのソフトを作りました。

## 注意

- 最低限の機能しか実装していません。ライセンスはフリーなので、勝手にいじってくださいませ・・・
- 不明点はコード見た方が早いかも？

## 使い方

settings フォルダの中に、バックアップ情報を書き込んだ toml ファイルを格納しておきます。

x-drive.toml、x-drive.toml が入ってますが、これは私の設定ファイルですので参考にして製作してください。
変えるポイントは、title、srcDir、dstDir、logDir でよいです。

- title は、好きな名前をつけれます。
- srcDir は、コピー元
- dstDir は、コピー先
- logDir は、ログの出力先になります。実際のログファイル名は、dstDir に 日付 をつけたファイル名で保存されます。
（MainPC-XDrive-20240427-190427.txt のような感じです。）
- intervalMinutes は、バックアップの実行間隔で、この時間ごとに robocopy 実行されます。
- delayMinutes は、アプリ起動後初回の実行時間です。アプリ起動直後に robocopy が実行されるとまずい場合
（例えば、ネットワークドライブの接続を待ってなど）は適当に設定します。
- option は、何も設定しないと "/MIR /XJF /XJD /COPY:DAT /DCOPY:DAT /FFT /R:1 /W:10 /MT:128 /NP /TEE" が設定されます。
（この機能はテストしてません）
- exclude は、何も設定しないと "\"System Volume Information\" \"$RECYCLE.BIN\"" が設定されます。
（この機能はテストしてません）

```
# -*- coding: utf-8 -*-

# バックアップ設定のタイトル
title = "MainPC X Drive Backup"

# バックアップ元ディレクトリ
srcDir = "X:"
# バックアップ先ディレクトリ
dstDir = "M:\\backups\\main-pc-daily\\MainPC-XDrive"
# ログファイルの出力先ディレクトリ
logDir = "M:\\backups\\main-pc-daily\\logs"

# バックアップ間隔（分）
intervalMinutes = 60
# 初回実行を遅らせるディレイ（分）
delayMinutes = 5

# robocopy のオプション
# option =

# 除外するファイル・ディレクトリ
# exclude =
```

- この設定で実行されるコマンド
```
robocopy X: M:\backups\main-pc-daily\MainPC-XDrive /LOG:M:\backups\main-pc-daily\logs\MainPC-XDrive-20240427-200427.txt /XD "System Volume Information" "$RECYCLE.BIN" /MIR /XJF /XJD /COPY:DAT /DCOPY:DAT /FFT /R:1 /W:10 /MT:128 /NP /TEE
```

- ログファイルの例
```
-------------------------------------------------------------------------------
   ROBOCOPY     ::     Windows の堅牢性の高いファイル コピー                              
-------------------------------------------------------------------------------

  開始: 2024年4月27日 19:24:37
   コピー元 = X:\
     コピー先 : M:\backups\main-pc-daily\MainPC-XDrive\

    ファイル: *.*
	    
 除外ディレクトリ: System Volume Information
	    $RECYCLE.BIN
	    
  オプション: *.* /FFT /TEE /S /E /DCOPY:DAT /COPY:DAT /PURGE /MIR /NP /XJF /XJD /MT:128 /R:1 /W:10 

------------------------------------------------------------------------------


------------------------------------------------------------------------------

                  合計     コピー済み      スキップ       不一致        失敗    Extras
   ディレクトリ:      1869      1869      1869         0         0         0
     ファイル:     10940         0     10940         0         0         0
      バイト:  26.725 g         0  26.725 g         0         0         0
       時刻:   0:00:03   0:00:00                       0:00:00   0:00:03
   終了: 2024年4月27日 19:24:40
```

## アプリの動作

- 起動するとタスクトレイにごせん像アイコンが表示されます。これが本体です。
- ごせん像を右クリックでメニュー、ダブクリでバックアップ結果を表示するためのダイアログが表示されます。
- バックアップ結果ダイアログのリスト項目をダブルクリックすると、そのバックアップ設定に設定されているログファイルフォルダを開きます。
- ちなみに、アプリの実行ファイルあるフォルダにログ(Logs フォルダ)が生成されます。

## 今後の予定

- 機能的にはもういいかなという感じです。
- コメントがほとんどないので、コード整理ついでにコメントを記入していきます。
- バックアップ設定を GUI化 したいですね。
